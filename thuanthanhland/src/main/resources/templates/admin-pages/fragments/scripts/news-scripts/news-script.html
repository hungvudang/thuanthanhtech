<!-- hiển thị hình ảnh mô tả trong news-detail -->
<script th:inline="javascript">
    /*<![CDATA[*/
    var $images = /*[[${news.images}]]*/'image';
    var $pathUploadImagesDir = /*[[${BASE_PATH_NEWS_RESOURCE} + '/' + ${news.id}+ '/' + ${DIR_IMAGE_DETAILS}]]*/'pathUploadImagesDir';

    if ($images != null && $images.length > 0) {
        $.each($images, function (index, img) {
            $('#images-container').append(`
                <div id="image${index}" class="form-group">
                    <label for="formControlInputImages${index}">Ảnh ${index + 1}</label>
                    <div class="container">
                        <div class="row d-flex flex-nowrap">
                            <div class="col-11">
                                <div class="row no-gutters">
                                    <div class="col-lg-4 col-md-12 col-sm-12 align-self-stretch">
                                        <img class="img-thumbnail w-100"
                                            id="news-image-preview-${index}"
                                            src='${$pathUploadImagesDir}/${img.name}'
                                            alt="no-thumbnail" style="max-height: 100px; object-fit: cover;">
                                    </div>
                                    <div class="col-lg-8 align-self-center">
                                        <input id="formControlInputImages${index}" name="news_images[]"
                                            class=" form-control form-control-sm" type="file" 
                                            accept="image/png, image/jpeg"
                                            onchange="previewImage(event, 'news-image-preview-${index}')" />
                                    </div>
                                </div>
                            </div>

                            <div class="col-1 align-self-start">
                                <i id="${index}" onclick="removeImage(event, ${img.id})" class="fas fa-times text text-danger"
                                    style="cursor: pointer;"></i>
                            </div>

                        </div>
                    </div>
                </div> 
            `)
            $('#old-images-container').append(`
                <div hidden id="image${index}" >
                    <input hidden type="text" id="images${index}.id" name="images[${index}].id" value="${img.id}"/>
                    <input hidden type="text" id="images${index}.name" name="images[${index}].name" value="${img.name}"/>
                </div>
            `)
        })
    }
    /*]]>*/
</script>


<!-- Thêm hình ảnh mô tả trong news-create -->
<script>
    var i = $('#images-container').children().length;

    $('#btn-add-image').click(function () {
        $('#images-container').append(`
            <div id="image${i}" class="form-group">
                <label for="formControlInputImages${i}">Ảnh ${i + 1}</label>
                <div class="container">
                    <div class="row d-flex flex-nowrap">
                        <div class="col-11">
                            <div class="row no-gutters">
                                <div class="col-lg-4 col-md-12 col-sm-12 align-self-stretch">
                                    <img class="img-thumbnail w-100"
                                        id="news-image-preview-${i}"
                                        src="/admin-static/images/no-thumbnail-medium.png"
                                        alt="no-thumbnail" style="max-height: 100px; object-fit: cover;">
                                </div>
                                <div class="col-lg-8 align-self-center">
                                    <input id="formControlInputImages${i}" name="news_images[]"
                                    class=" form-control form-control-sm" type="file" accept="image/png, image/jpeg"
                                    onchange="previewImage(event, 'news-image-preview-${i}')" />
                                </div>
                            </div>
                        </div>

                        <div class="col-1 align-self-start">
                            <i id="${i}" onclick="removeImage(event)" class="fas fa-times text text-danger"
                                style="cursor: pointer;"></i>
                        </div>

                    </div>
                </div>
            </div>
        `)
        i++;
    })

    function removeImage(event, imageId) {
        var btnId = event.target.id;

        // ajax delete image
        if (imageId) {
            if (confirm("Bạn chắc chắn muốn xóa ?")) {

                $.ajax({
                    url: '/api/images/' + imageId,
                    type: 'DELETE',
                    success: function (response) {
                        $(`#image${btnId}`).remove();

                        $(`#old-images-container > #image${btnId}`).remove();

                        if (btnId == i) {
                            i--;
                        }
                        if ($('#images-container').children().length == 0) {
                            i = 0;
                        }

                        vt.success(response, {
                            title: "Thành Công",
                            position: "top-right",
                            duration: 4000,
                            closable: true,
                            focusable: false,
                            callback: undefined
                        });


                    },

                    error: function (response) {
                        vt.error(response, {
                            title: "Thất Bại",
                            position: "top-right",
                            duration: 4000,
                            closable: true,
                            focusable: false,
                            callback: undefined
                        });
                    }
                })
            }
        } else {

            $(`#image${btnId}`).remove();

            if (btnId == i) {
                i--;
            }
            if ($('#images-container').children().length == 0) {
                i = 0;
            }

        }
    }
</script>

<!-- preview image -->
<script>
    function readURL(input, targetImgElementId) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();

            reader.onload = function (e) {
                $(`#${targetImgElementId}`).attr('src', e.target.result);
            }
            reader.readAsDataURL(input.files[0]); // convert to base64 string
        }
    }

    function previewImage(event, targetImgElementId) {
        readURL(event.target, targetImgElementId);
    }
</script>

<script>
    $('#btn-submit-custom').click(function () {
        $('#btn-submit-default').click();
    })
</script>